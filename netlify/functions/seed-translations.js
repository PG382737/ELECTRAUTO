// One-time: add English translations to all existing articles
// Hit GET /.netlify/functions/seed-translations?confirm=yes

const SUPABASE_URL = process.env.SUPABASE_URL;
const SUPABASE_SERVICE_KEY = process.env.SUPABASE_SERVICE_KEY;

async function supaFetch(endpoint, options = {}) {
    const res = await fetch(`${SUPABASE_URL}/rest/v1/${endpoint}`, {
        headers: {
            'apikey': SUPABASE_SERVICE_KEY,
            'Authorization': `Bearer ${SUPABASE_SERVICE_KEY}`,
            'Content-Type': 'application/json',
            'Prefer': options.prefer || 'return=representation',
        },
        method: options.method || 'GET',
        body: options.body ? JSON.stringify(options.body) : undefined
    });
    if (!res.ok) {
        const text = await res.text();
        throw new Error(`Supabase ${res.status}: ${text}`);
    }
    const ct = res.headers.get('content-type');
    if (ct && ct.includes('json')) return res.json();
    return null;
}

const TRANSLATIONS = {
    "prendre-soin-batterie-de-voiture": {
        title_en: "Électr'auto: The Importance of Taking Care of Your Car Battery",
        excerpt_en: "Find out why maintaining your battery is essential and how Électr'auto can help you avoid unexpected breakdowns.",
        content_en: `<p>Your car battery is much more than a simple component — it is the electrical heart of your vehicle. Without it, nothing starts, nothing works. At Électr'auto, we understand the crucial importance of a healthy battery to ensure the daily reliability of your car.</p><h2>The Battery: An Electrical Heart</h2><p>Your car battery powers all electrical systems, from starting the engine to the headlights, the entertainment system, and the air conditioning. A failing battery can lead to unexpected and costly breakdowns.</p><p>Signs of a weak battery:</p><ul><li>Slow or difficult engine starting</li><li>Dimming headlights</li><li>Battery warning light on the dashboard</li><li>Intermittent electrical systems</li><li>Battery older than 3–4 years</li></ul><h2>Prevention Rather Than Repair</h2><p>It is always better to prevent than to cure. Regular battery maintenance can extend its life and save you from major inconveniences. Here are some tips:</p><ul><li>Have your battery checked at every change of season</li><li>Clean the terminals regularly to prevent corrosion</li><li>Avoid leaving electrical accessories running with the engine off</li><li>Make sure the alternator is working properly</li></ul><p>Quebec's cold winters are particularly hard on batteries. A battery that works fine in summer may fail at the first frost.</p><h2>Électr'auto: Your Trusted Partner</h2><p>At Électr'auto, we have advanced diagnostic equipment to precisely test the condition of your battery and charging system. Our expertise in automotive electrical systems allows us to quickly identify potential problems.</p><h2>Why choose Électr'auto for your battery needs?</h2><ul><li><strong>Expertise:</strong> Over 20 years of experience in automotive electrical systems</li><li><strong>Accurate diagnostics:</strong> State-of-the-art equipment to test batteries and alternators</li><li><strong>Fast service:</strong> Battery replacement in under 30 minutes</li><li><strong>Honest advice:</strong> We will tell you if your battery still has life or if it's time for a replacement</li></ul><p>Don't wait until you're stranded to take action. Contact us for a diagnostic of your electrical system and drive with peace of mind.</p>`
    },
    "reparation-de-lair-climatise-auto-a-quebec-trouvez-le-meilleur-prix-sans-compromettre-la-qualite": {
        title_en: "Auto Air Conditioning Repair in Quebec City: Find the Best Price Without Compromising Quality",
        excerpt_en: "Complete guide to repairing your car's air conditioning in Quebec City. Discover costs, signs of problems, and where to get it fixed.",
        content_en: `<p>When the Quebec summer hits with its hot and humid days, a properly working car air conditioning system becomes essential. But how do you find the best price for your car's A/C repair without compromising service quality?</p><h2>Why is A/C repair crucial?</h2><p>A faulty air conditioning system goes beyond mere discomfort. It can also affect driving safety by causing heat-related fatigue and reducing visibility from windshield condensation. Additionally, a leaking system can release refrigerants that are harmful to the environment.</p><h2>How to know if your A/C needs repair?</h2><p>Here are the main signs to watch for:</p><ul><li>The air blowing is no longer as cold as before</li><li>Unusual noises when the system is activated</li><li>Unpleasant odours coming from the vents</li><li>The system turns on and off intermittently</li><li>Fluid leaks under the vehicle</li></ul><h2>How much does auto A/C repair cost in Quebec City?</h2><p>Repair costs vary considerably depending on the type of problem:</p><ul><li><strong>Refrigerant recharge:</strong> The most common and least expensive repair</li><li><strong>Leak repair:</strong> Average cost, depends on the location of the leak</li><li><strong>Compressor replacement:</strong> The most expensive repair, but sometimes necessary</li><li><strong>Condenser or evaporator replacement:</strong> Variable cost depending on the model</li></ul><p>At Électr'auto, we offer a transparent diagnosis and detailed quote before any work.</p><h2>Where to get your auto A/C repaired in Quebec City?</h2><p>Électr'auto Québec is your specialist in automotive air conditioning repair. Located at 2485 Boulevard Wilfrid-Hamel, we serve the entire greater Quebec City area. Our team has the expertise and tools needed to diagnose and repair all types of A/C systems.</p><h2>Tips for keeping your A/C in good shape</h2><ul><li>Run your air conditioning for at least 10 minutes per week, even in winter</li><li>Replace the cabin filter as recommended by the manufacturer</li><li>Have the system inspected before each summer season</li><li>Don't overload the system by setting it to maximum right at start-up</li></ul>`
    },
    "reparation-de-climatiseurs-automobiles": {
        title_en: "Automotive Air Conditioner Repair",
        excerpt_en: "Everything you need to know about modern automotive air conditioner repair and the technologies that make them more efficient.",
        content_en: `<p>Automotive air conditioners have evolved considerably over the years. Modern vehicles integrate sophisticated air conditioning systems that require specialized expertise for their maintenance and repair.</p><h2>Modern automotive A/C technologies</h2><p>Recent vehicles use increasingly advanced air conditioning systems, with dual-zone or tri-zone temperature controls, air quality sensors, and high-performance filtration systems. These technological advances improve comfort but also add complexity to repairs.</p><h2>Importance of preventive maintenance</h2><p>Regular maintenance of your air conditioning system helps to:</p><ul><li>Maintain optimal cooling performance</li><li>Prevent costly breakdowns</li><li>Ensure good air quality inside the cabin</li><li>Extend the lifespan of components</li></ul><h2>Main problems and solutions</h2><p>The most common problems we encounter include refrigerant leaks, failing compressors, clogged condensers, and electrical issues in the control circuit. Our advanced diagnostic equipment allows us to quickly identify the source of the problem.</p><h2>Our approach at Électr'auto</h2><p>At Électr'auto, our approach combines proven diagnostic methods with cutting-edge technology. We use electronic leak detectors, precision gauges, and computerized diagnostic tools to ensure accurate and lasting repairs.</p><p>When it comes to your vehicle's air conditioning, don't compromise. Contact Électr'auto for a professional diagnosis and quality repair.</p>`
    },
    "pourquoi-choisir-electrauto-pour-la-reparation-de-votre-climatisation-automobile": {
        title_en: "Why Choose Électr'auto for Your Automotive Air Conditioning Repair",
        excerpt_en: "Discover what sets Électr'auto apart from other shops for your automotive air conditioning system repair.",
        content_en: `<p>Choosing a repair shop for your automotive air conditioning is an important decision. At Électr'auto, we understand that your comfort and safety are at stake. Here's why we are the trusted choice in Quebec City.</p><h2>Modern Diagnostics</h2><p>Our shop is equipped with the latest diagnostic tools on the market. This equipment allows us to precisely identify the origin of an A/C problem, whether mechanical, electrical, or electronic. An accurate diagnosis means an efficient and cost-effective repair.</p><h2>Modern vehicles and A/C systems</h2><p>The air conditioning systems in modern vehicles are closely linked to other electronic systems in the vehicle. An A/C problem can sometimes be related to the engine management system, temperature sensors, or the vehicle's CAN network. Our expertise in automotive electronics gives us a unique advantage in solving these complex problems.</p><h2>The heart of your comfort</h2><p>Your air conditioning system does much more than cool the air. It regulates humidity, filters particles and allergens, and helps defog your windows. A well-functioning system is essential for your comfort and safety, especially during Quebec's hot and humid summers.</p><h2>Why choose Électr'auto?</h2><ul><li><strong>Specialized expertise:</strong> Over 20 years of experience in automotive electrical and electronic systems</li><li><strong>State-of-the-art equipment:</strong> Latest generation diagnostic and repair tools</li><li><strong>Transparency:</strong> Detailed quote before any work</li><li><strong>Warranty:</strong> Our repairs are guaranteed for your peace of mind</li></ul><h2>Preventive A/C maintenance</h2><p>We recommend an annual inspection of your air conditioning system, ideally in spring before the hot season. This preventive inspection can save you from costly repairs and ensure your comfort throughout the summer.</p><h2>Be ready for the seasons</h2><p>Don't let an A/C breakdown ruin your summer days. Book an appointment at Électr'auto for a complete diagnostic of your air conditioning system. Our qualified team is ready to serve you with professionalism and courtesy.</p>`
    },
    "air-climatise-automobile-quest-ce-qui-est-important-a-savoir": {
        title_en: "Automotive Air Conditioning: What You Need to Know",
        excerpt_en: "Complete guide on how automotive air conditioning works and the common problems to watch for.",
        content_en: `<p>Automotive air conditioning has become essential equipment in our vehicles. But do you really know how it works and what signs indicate a problem? Here is everything you need to know.</p><h2>How does automotive air conditioning work?</h2><p>Your car's air conditioning system works on the principle of compressing and expanding a refrigerant gas. The compressor compresses the gas, which then passes through the condenser where it cools and liquefies. The liquid passes through the expansion valve, turns back into a gas, and absorbs heat from the cabin via the evaporator.</p><h2>Key components</h2><p>The main components are:</p><ul><li><strong>The compressor:</strong> The heart of the system, driven by the engine belt</li><li><strong>The condenser:</strong> Dissipates heat from the refrigerant to the outside</li><li><strong>The evaporator:</strong> Absorbs heat from the cabin</li><li><strong>The expansion valve:</strong> Regulates refrigerant flow</li><li><strong>The receiver-drier:</strong> Removes moisture and impurities</li></ul><h2>Important A/C problems to inspect</h2><p>Several common problems can affect your air conditioning system:</p><h3>Is there excessive humidity in the vehicle?</h3><p>Excess moisture in the cabin can indicate a problem with the evaporator or drainage system. The evaporator normally produces condensation that is drained under the vehicle, but if the drain is clogged, water can accumulate and cause musty odours.</p><h3>Can you detect odours in the air?</h3><p>Unpleasant odours can indicate the presence of mould or bacteria in the evaporator. Professional cleaning of the system can solve this problem.</p><h3>Is there a leak?</h3><p>Refrigerant leaks are one of the most common problems. They can occur at connections, seals, or the components themselves. Even a minor leak reduces system efficiency and must be repaired.</p><h3>Is your A/C only blowing hot air?</h3><p>If your air conditioning only blows hot air, it can indicate a lack of refrigerant, a failing compressor, or an electrical problem. It is important not to ignore this symptom.</p><h2>Why is it important to check your vehicle's A/C?</h2><p>A well-functioning air conditioning system contributes to your comfort, your health (air filtration), and even your safety (effective defogging). Regular maintenance is an investment worth making.</p><h2>Benefits of recharging your car's A/C</h2><p>Regular refrigerant recharging keeps the system at its optimal performance level. Over time, even a sealed system can lose a small amount of refrigerant, gradually reducing its efficiency.</p><h2>Preventive maintenance is a good idea</h2><p>At Électr'auto, we recommend annual maintenance of your air conditioning system. This includes checking the refrigerant level, inspecting components, performance testing, and system cleaning. Contact us to book an appointment.</p>`
    },
    "pourquoi-choisir-un-garage-fiable-pour-votre-volkswagen-a-quebec": {
        title_en: "Why Choose a Reliable Garage for Your Volkswagen in Quebec City?",
        excerpt_en: "Discover the importance of entrusting your Volkswagen to a trusted garage in Quebec City for quality maintenance.",
        content_en: `<p>Volkswagen is one of the most popular brands in Quebec, known for its reliability and performance. However, like any vehicle, a Volkswagen requires regular maintenance and sometimes specialized repairs. Here's why it's essential to choose a reliable garage for your Volkswagen in Quebec City.</p><h2>Why is it vital to have a reliable Volkswagen garage in Quebec?</h2><p>Volkswagen vehicles integrate advanced technologies, including TSI and TDI systems, DSG transmissions, and sophisticated electronic systems. A garage familiar with these technologies can diagnose and repair problems more efficiently, saving you time and money.</p><p>A mechanic who understands Volkswagen specifics can:</p><ul><li>Use the right diagnostic tools compatible with VAG systems</li><li>Quickly identify common problems specific to VW models</li><li>Recommend appropriate maintenance intervals</li><li>Use quality parts suited to your vehicle</li></ul><p>At Électr'auto, our expertise in automotive electronic systems allows us to work efficiently on Volkswagen vehicles. Our advanced diagnostic tools are compatible with all VAG group systems, enabling us to perform accurate diagnostics and quality repairs.</p><h2>Regular maintenance for a reliable brand like Volkswagen</h2><p>Regular maintenance is the key to your Volkswagen's longevity. Here are the essential services not to overlook:</p><ul><li><strong>Oil change:</strong> Essential for engine health, to be done at recommended intervals</li><li><strong>Timing belt:</strong> A crucial replacement to prevent major engine damage</li><li><strong>Cooling system:</strong> Regular fluid and component checks</li><li><strong>Brakes:</strong> Inspection of pads, discs, and brake fluid</li><li><strong>DSG transmission:</strong> Transmission fluid change at recommended intervals</li></ul><p>Contact Électr'auto for a complete maintenance of your Volkswagen. Our qualified team will take care of your vehicle with professionalism and transparency.</p>`
    },
    "ce-que-vous-devez-faire-lorsque-vous-recherchez-un-atelier-de-reparation-automobile": {
        title_en: "What to Do When Looking for an Auto Repair Shop",
        excerpt_en: "Practical tips for finding a reliable and competent auto repair shop in the Quebec City area.",
        content_en: `<p>Finding a good auto repair shop can seem difficult. Between major chains, dealerships, and independent garages, the choice is vast. Here's a guide to help you make the right choice.</p><h2>The importance of finding a reliable auto repair shop</h2><p>A good auto repair shop is a trusted partner for the lifetime of your vehicle. It will provide honest diagnostics, quality repairs, and preventive maintenance recommendations that will save you money in the long run.</p><p>Conversely, a poor choice can lead to unnecessary repairs, inflated bills, and even additional damage to your vehicle.</p><h2>Google and online reviews</h2><p>Before choosing a shop, check online reviews. Google reviews are particularly useful because they are difficult to fake. Look at:</p><ul><li>The average rating (aim for 4 stars and above)</li><li>The total number of reviews (the more there are, the more reliable the rating)</li><li>Detailed customer comments</li><li>How the shop responds to negative reviews</li></ul><h2>The 4 main factors to consider when choosing a good auto repair shop</h2><h3>1. Check their diagnostic equipment</h3><p>A modern shop must have up-to-date computerized diagnostic tools. Today's vehicles are essentially computers on wheels, and a good diagnosis requires the right tools. At Électr'auto, we continuously invest in the latest diagnostic technologies.</p><h3>2. Standard checks</h3><p>Make sure the shop is properly registered, holds the necessary permits, and employs certified mechanics. A professional shop will be proud to show you its accreditations.</p><h3>3. Verify their reputation</h3><p>A shop recognized in its community is generally a guarantee of quality. Ask for recommendations from people you know, check if the shop is a member of professional associations, and if it's active in the local community.</p><h3>4. Price transparency</h3><p>A good shop will always provide a detailed quote before starting work. Be wary of shops that refuse to give an estimate or that add surprise charges.</p><h2>In conclusion</h2><p>Taking the time to choose your auto repair shop wisely is a worthwhile investment. At Électr'auto, we pride ourselves on offering transparent, professional, and courteous service for over 20 years. Feel free to visit us or call us to see the difference for yourself.</p>`
    },
    "reparation-air-climatise-sur-les-voitures": {
        title_en: "Car Air Conditioning Repair",
        excerpt_en: "Here are the main reasons to use a qualified technician for your vehicle's air conditioning repair.",
        content_en: `<h2>Car Air Conditioning Repair</h2><p>Here are reasons to choose good repair systems for your automotive air conditioning. A faulty automotive air conditioning system is not just a simple inconvenience — it can affect your safety and your vehicle's resale value.</p><h2>Reasons to choose quality repair:</h2><ul><li>A well-functioning system maintains a comfortable and safe temperature in the cabin</li><li>Air conditioning helps defog windows quickly, improving visibility</li><li>A well-maintained system uses less fuel</li><li>Preventive repairs cost less than emergency ones</li></ul><h2>Use a qualified technician for your A/C repair</h2><p>Repairing an automotive air conditioning system requires specific skills and specialized equipment. The refrigerant used in these systems is a controlled product that must be handled according to strict standards to protect the environment.</p><p>A qualified technician has:</p><ul><li>Certification to handle refrigerants</li><li>Specialized diagnostic tools</li><li>Experience to quickly identify problems</li><li>Knowledge of different systems across brands and models</li></ul><h2>Why choose Électr'auto?</h2><p>At Électr'auto, we specialize in air conditioning repair for all vehicle brands, whether popular or luxury. Our team has over 20 years of experience and uses state-of-the-art diagnostic equipment.</p><h2>In summary</h2><p>Don't neglect the maintenance of your air conditioning system. A well-maintained system will keep you cool during hot Quebec summer days and save you from costly repairs. Contact Électr'auto today for a professional diagnostic.</p>`
    },
    "garage-bmw": {
        title_en: "BMW Garage",
        excerpt_en: "How to program your BMW garage door opener with HomeLink. Complete step-by-step guide.",
        content_en: `<p>BMW vehicles are equipped with the HomeLink system, a built-in universal transmitter that lets you program your garage door opening directly from your car. Here's how to set it up.</p><h2>How to program a BMW garage door opener?</h2><p>Programming your BMW HomeLink garage door opener is a simple process that can be completed in a few minutes. However, the exact steps may vary slightly depending on the model and year of your BMW.</p><h2>How does BMW HomeLink work?</h2><p>HomeLink is a radio transmission system built into the interior rear-view mirror or the ceiling console of your BMW. It can store up to three different devices (garage door, gate, outdoor lighting, etc.) and control them with simple buttons.</p><h2>How to set up a BMW garage door opener?</h2><p>Here are the general steps to program HomeLink:</p><ol><li>Press and hold the two outer HomeLink buttons for about 20 seconds to reset the system (the light flashes rapidly)</li><li>Place your garage door remote about 5 cm from the HomeLink module</li><li>Simultaneously press the remote button and the desired HomeLink button</li><li>Hold both buttons until the HomeLink light flashes rapidly</li><li>Release the buttons — the programming is saved</li></ol><h2>Setup is complete and your HomeLink is now ready</h2><p>Once programming is complete, test the system by pressing the programmed HomeLink button within range of your garage door. If the door opens, programming was successful. Otherwise, you may need to sync your garage door receiver by pressing its learn button.</p><h2>Tips and safety measures for BMW HomeLink programming</h2><ul><li>Perform programming in a safe location with the engine off</li><li>Make sure no one is in the path of the garage door during testing</li><li>If programming doesn't work, check your remote's battery</li><li>Some newer garage door openers require an additional sync step</li></ul><h2>Conclusion</h2><p>If you have difficulty programming your HomeLink system or need help with any other electronic aspect of your BMW, Électr'auto is here for you. Our expertise in BMW electronics allows us to quickly resolve any programming or configuration issue.</p>`
    },
    "entretien-de-votre-bmw-a-quebec": {
        title_en: "Maintaining Your BMW in Quebec City",
        excerpt_en: "Complete guide to maintaining your BMW in Quebec City: costs, maintenance routine, and expert tips.",
        content_en: `<p>Owning a BMW is an incomparable driving pleasure. But to maintain the performance and reliability of your German vehicle, regular and proper maintenance is essential. Here is your complete guide to maintaining your BMW in Quebec City.</p><h2>The importance of consulting an expert when buying a used BMW in Quebec</h2><p>If you're considering buying a used BMW, a pre-purchase inspection by a specialist is highly recommended. BMWs are sophisticated vehicles, and some problems may not be apparent during a test drive. An expert can check the electronic systems, engine, transmission, and overall condition of the vehicle.</p><h2>Advantages of expert parts</h2><p>At Électr'auto, we have access to quality parts equivalent to original parts, often at a lower cost than the dealership. We can also install genuine BMW parts if you prefer.</p><h2>The cost of regular BMW maintenance in Quebec City</h2><p>Maintaining a BMW may seem more expensive than an ordinary vehicle, but regular maintenance prevents major repairs and protects your vehicle's resale value. At Électr'auto, we offer competitive rates for BMW maintenance while maintaining high quality standards.</p><h2>General BMW maintenance routine</h2><p>Here are the main maintenance points to follow for your BMW:</p><h3>Oil change</h3><p>BMW recommends an oil change every 15,000 km or once a year, whichever comes first. Always use oil that meets BMW specifications (BMW Longlife-01 or LL-04 depending on the engine). At Électr'auto, we complete oil changes in under 30 minutes.</p><h3>Why is this so important?</h3><p>Beyond lubrication, engine oil cleans, cools, and protects the internal components of the engine. Used oil loses its properties and can damage your engine.</p><h3>Preventing breakdowns</h3><p>Regular maintenance is the best insurance against unexpected breakdowns. Modern BMWs are equipped with maintenance alert systems (CBS — Condition Based Service), but don't rely solely on these alerts.</p><h3>Antifreeze and coolant replacement</h3><p>The BMW cooling system requires a specific coolant. Regular replacement prevents corrosion of the system and ensures optimal protection against Quebec's freezing temperatures.</p><h3>Air filter cleaning</h3><p>The air filter and cabin filter should be replaced regularly to ensure optimal engine performance and good air quality inside the cabin.</p><h2>Conclusion</h2><p>Maintaining your BMW is an investment in the longevity and performance of your vehicle. At Électr'auto in Quebec City, we are BMW specialists and we put our expertise at your service. Contact us at 1.418.666.9769 to book an appointment.</p>`
    }
};

exports.handler = async (event) => {
    const headers = {
        'Content-Type': 'application/json',
        'Access-Control-Allow-Origin': 'https://electrautoquebec.com'
    };

    if (event.httpMethod !== 'GET') {
        return { statusCode: 405, headers, body: JSON.stringify({ error: 'GET only' }) };
    }

    const params = event.queryStringParameters || {};
    if (params.confirm !== 'yes') {
        return { statusCode: 400, headers, body: JSON.stringify({ error: 'Add ?confirm=yes to run' }) };
    }

    try {
        const results = [];
        const slugs = Object.keys(TRANSLATIONS);

        for (const slug of slugs) {
            const trans = TRANSLATIONS[slug];

            // Find article by slug
            const articles = await supaFetch(`articles?slug=eq.${encodeURIComponent(slug)}&limit=1`);
            if (!articles || articles.length === 0) {
                results.push({ slug, status: 'not_found' });
                continue;
            }

            const article = articles[0];

            // Update with English translations
            await supaFetch(`articles?id=eq.${article.id}`, {
                method: 'PATCH',
                body: {
                    title_en: trans.title_en,
                    excerpt_en: trans.excerpt_en,
                    content_en: trans.content_en,
                    updated_at: new Date().toISOString()
                }
            });

            results.push({ slug, status: 'updated' });
        }

        return {
            statusCode: 200, headers,
            body: JSON.stringify({ success: true, results })
        };
    } catch (err) {
        return { statusCode: 500, headers, body: JSON.stringify({ error: err.message }) };
    }
};
